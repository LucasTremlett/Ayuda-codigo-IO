---
title: "Codigo IO"
output: html_document
---

### Librerias

```{r}
install.packages("tidyverse")
install.packages("stats")
install.packages("rtweet")
install.packages("igraph")
install.packages("leaflet")
install.packages("syuzhet")
install.packages("rvest")
install.packages("wordcloud")
install.packages("tm")
install.packages("quantmod")
install.packages("rgdal")
install.packages("stargazer")
install.packages("olsrr")
install.packages("nlme")
install.packages("gmodels")
install.packages("psych")
install.packages("gt")
install.packages("GPArotation")
install.packages("ltm")
install.packages("nFactors")
install.packages("skimr")
install.packages("ggrepel")
install.packages("waffle")
install.packages("readxl")
install.packages("remotes")
install.packages("ggpubr")
install.packages("lm.beta")
install.packages("survey")
install.packages("tinytex")
tinytex::install_tinytex()
tinytex:::is_tinytex()
install.packages("srvyr")
install.packages("sjstats")
install.packages("ggannotate")
install.packages("paletteer")
install.packages("openxlsx")
install.packages("packrat")
install.packages("rsconnect")
```



### Limpieza variables


#### Pasar variable numérica a factor (poniendo nombre a los factores)

```{r}
options(OutDec= ",")
cars<- force(mtcars)
cars$cyl <- factor(cars$cyl,
                   levels = c(4,6,8),
                    labels = c("Cuatro", "Seis", "Ocho")) 
cars
```




#### Agrupar y crear medias y medianas

```{r}
options(OutDec= ",")
library(tidyverse)
cars <- force(mtcars)

cars %>% group_by(vs) %>% summarise(media=mean(disp), mediana=median(disp), maximo=max(disp), minimo=min(disp))
```


#### Pivotar (Pendiente)


PUT RELOCATE THROUGH CONTAINS TOO

### Descriptivos


### Tabla con porcentajes de una variable

```{r}
growth <- force(PlantGrowth)
prop.table(table(growth$group))
```


#### Tabla cruzada básica 

```{r}
options(OutDec= ",")
library("gmodels")
cars <- force(mtcars)
CrossTable(cars$vs, cars$am)
```



### Tabla cruzada para informe con media/mediana/max/min. Básica. https://rpubs.com/jdjohn215/three-way-crosstab-table-with-gt

```{r}
options(OutDec= ",")
library(gt)
library(tidyverse)
example <- read.csv("https://raw.githubusercontent.com/jdjohn215/2020-RStudio-Table-Contest/master/data/income_by_sex_and_age.csv")
example %>% group_by(OCC2010, SEX) %>% summarise(wage=mean(median_wage)) %>% ungroup() %>%
  pivot_wider(names_from = c(SEX), values_from=wage) %>%
  rename("Hombre"="Male", "Mujer"="Female") %>% mutate(Diferencia=Hombre-Mujer) %>%
  arrange(desc(Diferencia)) %>% gt(rowname_col = "OCC2010") %>%
  tab_options(container.height = px(500)) %>% fmt_currency(columns = c(2:4), decimals = 0, currency="euro", sep_mark=".") %>% 
  tab_header(title="Título", subtitle = "Subtítulo") %>%
  tab_stubhead("Trabajo") %>%
  tab_options(heading.title.font.size = 24,
              heading.title.font.weight = "bolder",
              column_labels.font.weight = "bold") %>% 
  tab_source_note(md("**Fuente:** Poner fuente aquí")) %>% 
  tab_footnote(footnote = "First footnote", locations = cells_stubhead()) %>% 
  tab_footnote(footnote="Second footnote", locations=cells_column_labels("Hombre")) %>% 
  data_color(columns = vars(Diferencia),
             colors = scales::col_numeric(
               palette = as.character(paletteer::paletteer_d(palette = "RColorBrewer::Reds")),
               domain = NULL))

```


### Tabla cruzada para informes con porcentajes. Básica. 

```{r}
options(OutDec= ",")
library(gt)
library(tidyverse)
library(gmodels)
growth <- force(PlantGrowth)
growth %>% mutate(tot=1) %>% group_by(group) %>% summarise(porc=sum(tot)/30) %>% ungroup() %>% gt(rowname_col = "group") %>%
  tab_options(container.height = px(500)) %>%  tab_header(title="Título", subtitle = "Subtítulo") %>%
  tab_stubhead("group") %>% 
  tab_options(heading.title.font.size = 24,
              heading.title.font.weight = "bolder",
              column_labels.font.weight = "bold") %>% 
  tab_source_note(md("**Fuente:** Poner fuente aquí")) %>% 
  tab_footnote(footnote = "First footnote", locations = cells_stubhead()) %>% 
  fmt_percent(columns=c(2), dec_mark = ",")
```


### Tabla cruzada para informe con media/mediana/max/min. Compleja. https://rpubs.com/jdjohn215/three-way-crosstab-table-with-gt


```{r}
options(OutDec= ",")
library(gt)
library(tidyverse)
example <- read.csv("https://raw.githubusercontent.com/jdjohn215/2020-RStudio-Table-Contest/master/data/income_by_sex_and_age.csv")
example %>%  pivot_wider(names_from = c(SEX), values_from=median_wage) %>% mutate(Diferencia=Male-Female) %>% 
  rename("Hombre"="Male", "Mujer"="Female") %>% 
  pivot_wider(names_from = c(age_category), values_from=c(Hombre, Mujer, Diferencia),
              names_glue = "{age_category}_{.value}") %>% 
  relocate(OCC2010, contains("Under"), contains("35 to"), contains("plus")) %>% 
  gt(rowname_col = "OCC2010", groupname_col = "variable") %>% 
  tab_options(container.height = px(500)) %>%  tab_header(title="Título", subtitle = "Subtítulo") %>% 
  tab_stubhead("OCC2010") %>% 
  tab_spanner_delim(delim = "_") %>% 
  tab_options(heading.title.font.size = 24,
              heading.title.font.weight = "bolder",
              column_labels.font.weight = "bold",
              row_group.font.weight = "bold") %>% 
  tab_source_note(md("**Fuente:** Poner fuente aquí")) %>% 
  tab_footnote(footnote = "Primera nota a pie de página", locations = cells_stubhead()) %>% 
  fmt_currency(columns = c(2:10), decimals = 0, currency="euro", sep_mark=".") %>% 
  data_color(columns = c(contains("Diferencia")),
             colors = scales::col_numeric(
               palette = as.character(paletteer::paletteer_d(palette = "RColorBrewer::Reds")),
               domain = NULL))

?pivot_wider
```


### Tabla cruzada para informes con porcentajes. Compleja. 

```{r}
library("datasets")
library("gt")
library("tidyverse")
cancerdata<- force(esoph)
cancerdata %>% group_by(agegp) %>% summarise(tot.cont=sum(ncontrols), tot.cases=sum(ncases)) %>% 
  mutate(porc.cont= prop.table(tot.cont), porc.cases= prop.table(tot.cases), variable="Edad") %>%  rename("factor"="agegp") %>% 
  rbind(cancerdata %>% group_by(alcgp) %>% summarise(tot.cont=sum(ncontrols), tot.cases=sum(ncases)) %>% 
  mutate(porc.cont= prop.table(tot.cont), porc.cases= prop.table(tot.cases), variable="Alcohol") %>% rename("factor"="alcgp")) %>% 
  rbind(cancerdata %>% group_by(tobgp) %>% summarise(tot.cont=sum(ncontrols), tot.cases=sum(ncases)) %>% 
  mutate(porc.cont= prop.table(tot.cont), porc.cases= prop.table(tot.cases), variable="Tabaco") %>% rename("factor"="tobgp")) %>%
  relocate(variable, factor, tot.cont, porc.cont, tot.cases, porc.cases) %>% 
  gt(rowname_col = "factor", groupname_col = "variable") %>% 
  tab_options(container.height = px(500)) %>%  tab_header(title="Título", subtitle = "Subtítulo") %>% 
  tab_options(heading.title.font.size = 24,
              heading.title.font.weight = "bolder",
              column_labels.font.weight = "bold",
              row_group.font.weight = "bold") %>% 
  tab_source_note(md("**Fuente:** Poner fuente aquí")) %>% 
  tab_footnote(footnote = "Primera nota a pie de página", locations = cells_column_labels("tot.cont")) %>% 
  fmt_percent(columns=c(4,6), dec_mark = ",") %>% 
  tab_spanner(label = "Controles", columns=vars("tot.cont", "porc.cont")) %>% 
  tab_spanner(label="Casos", columns=vars("tot.cases", "porc.cases")) %>% 
  cols_label(tot.cont="Total", porc.cont="Porcentaje", tot.cases="Total", porc.cases="Porcentaje")
```

